{"version":3,"file":"detail.js","sources":["pages/questions/detail.vue","D:/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcXVlc3Rpb25zL2RldGFpbC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <uni-card :is-shadow=\"false\" class=\"question-card\">\r\n      <view class=\"title\">\r\n        <text class=\"type-tag\">{{ renderType(question.type) }}</text>\r\n        {{ question.title }}\r\n      </view>\r\n      <view class=\"meta-row\">\r\n        <uni-tag :text=\"getCategoryName(question.categoryId)\" size=\"small\" type=\"success\" />\r\n        <uni-tag :text=\"'分值 ' + question.score\" size=\"small\" type=\"primary\" />\r\n        <text class=\"muted\">预计 {{ question.duration }}s</text>\r\n      </view>\r\n\r\n      <view class=\"option-area\" v-if=\"isMultiple(question.type)\">\r\n        <checkbox-group @change=\"onMultipleChange\">\r\n          <label v-for=\"opt in question.options\" :key=\"opt.value\" class=\"option\">\r\n            <checkbox\r\n              :value=\"opt.value\"\r\n              :checked=\"selected.includes(opt.value)\"\r\n              color=\"#2563eb\"\r\n              style=\"transform: scale(0.9);\"\r\n            />\r\n            <text class=\"option-text\">{{ opt.value }}. {{ opt.text }}</text>\r\n          </label>\r\n        </checkbox-group>\r\n      </view>\r\n\r\n      <view class=\"option-area\" v-else-if=\"isShortAnswer(question.type)\">\r\n        <textarea\r\n          class=\"short-input\"\r\n          :value=\"selected[0] || ''\"\r\n          placeholder=\"请输入答案\"\r\n          auto-height\r\n          @input=\"onTextChange\"\r\n        />\r\n      </view>\r\n\r\n      <view class=\"option-area\" v-else>\r\n        <radio-group @change=\"onSingleChange\">\r\n          <label v-for=\"opt in question.options\" :key=\"opt.value\" class=\"option\">\r\n            <radio\r\n              :value=\"opt.value\"\r\n              :checked=\"selected.includes(opt.value)\"\r\n              color=\"#2563eb\"\r\n              style=\"transform: scale(0.9);\"\r\n            />\r\n            <text class=\"option-text\">{{ opt.value }}. {{ opt.text }}</text>\r\n          </label>\r\n        </radio-group>\r\n      </view>\r\n\r\n      <view class=\"actions\">\r\n        <button\r\n          type=\"primary\"\r\n          class=\"primary-btn\"\r\n          :loading=\"submitting\"\r\n          :disabled=\"!selected.length\"\r\n          @tap=\"handleSubmit\"\r\n        >\r\n          提交答案\r\n        </button>\r\n        <button class=\"ghost-btn\" @tap=\"backToList\">返回题库</button>\r\n      </view>\r\n    </uni-card>\r\n\r\n    <uni-card v-if=\"feedback\" title=\"判题结果\" :is-shadow=\"false\">\r\n      <view class=\"result\" :class=\"{ correct: feedback.isCorrect, wrong: !feedback.isCorrect }\">\r\n        <uni-icons\r\n          :type=\"feedback.isCorrect ? 'checkmarkempty' : 'closeempty'\"\r\n          :color=\"feedback.isCorrect ? '#10b981' : '#ef4444'\"\r\n          size=\"24\"\r\n        />\r\n        <text class=\"result-text\">{{ feedback.isCorrect ? '回答正确' : '回答错误' }}</text>\r\n      </view>\r\n      <view class=\"answer\">\r\n        <text class=\"muted\">正确答案：</text>\r\n        <text class=\"answer-text\">{{ feedback.correctAnswer.join(', ') }}</text>\r\n      </view>\r\n      <view class=\"explain\">\r\n        <text class=\"muted\">解析：</text>\r\n        <text>{{ feedback.explanation }}</text>\r\n      </view>\r\n      <view class=\"progress-info\" v-if=\"feedback.progress\">\r\n        <text class=\"muted\">总进度：{{ feedback.progress.percent }}%</text>\r\n      </view>\r\n    </uni-card>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport { onLoad } from '@dcloudio/uni-app';\r\nimport { fetchCategoryTree, flattenCategoryTree } from '@/api/categories.js';\r\nimport { fetchQuestionDetail } from '@/api/questions.js';\r\nimport { submitAnswer as submitAnswerApi } from '@/api/answers.js';\r\n\r\nconst question = ref({\r\n  options: [],\r\n});\r\nconst categories = ref([]);\r\nconst selected = ref([]);\r\nconst feedback = ref(null);\r\nconst submitting = ref(false);\r\n\r\nconst renderType = (type) => {\r\n  const text = String(type || '');\r\n  const lower = text.toLowerCase();\r\n  if (lower.includes('multiple') || text.includes('多选')) return '多选';\r\n  if (lower.includes('true') || lower.includes('judge') || text.includes('判断') || text.includes('是非')) {\r\n    return '判断';\r\n  }\r\n  if (lower.includes('fill') || lower.includes('short') || text.includes('填空') || text.includes('简答')) {\r\n    return '简答';\r\n  }\r\n  return '单选';\r\n};\r\n\r\nconst isMultiple = (type) => {\r\n  const text = String(type || '');\r\n  const lower = text.toLowerCase();\r\n  return lower.includes('multiple') || text.includes('多选');\r\n};\r\nconst isShortAnswer = (type) => {\r\n  const text = String(type || '');\r\n  const lower = text.toLowerCase();\r\n  return lower.includes('fill') || lower.includes('short') || text.includes('填空') || text.includes('简答');\r\n};\r\n\r\nconst onSingleChange = (e) => {\r\n  selected.value = [e.detail.value];\r\n};\r\n\r\nconst onMultipleChange = (e) => {\r\n  selected.value = e.detail.value || [];\r\n};\r\n\r\nconst onTextChange = (e) => {\r\n  selected.value = [e.detail.value || ''];\r\n};\r\n\r\nconst getCategoryName = (id) =>\r\n  categories.value.find((c) => String(c.id) === String(id))?.name || '未分类';\r\n\r\nconst backToList = () => {\r\n  uni.switchTab({ url: '/pages/questions/index' });\r\n};\r\n\r\nconst loadData = async (id) => {\r\n  try {\r\n    const [catTree, detail] = await Promise.all([fetchCategoryTree(), fetchQuestionDetail(id)]);\r\n    categories.value = flattenCategoryTree(catTree);\r\n    if (!detail?.id) {\r\n      uni.showToast({ title: '题目不存在', icon: 'none' });\r\n      question.value = { options: [] };\r\n      return;\r\n    }\r\n    question.value = detail;\r\n    selected.value = [];\r\n    feedback.value = null;\r\n  } catch (err) {\r\n    console.error(err);\r\n    uni.showToast({ title: '加载失败', icon: 'none' });\r\n  }\r\n};\r\n\r\nconst handleSubmit = async () => {\r\n  if (!question.value.id) return;\r\n  const chosen = (selected.value || []).map((v) => (typeof v === 'string' ? v.trim() : v));\r\n  if (!chosen.length || !chosen.some((v) => v)) {\r\n    uni.showToast({ title: '请选择答案', icon: 'none' });\r\n    return;\r\n  }\r\n  submitting.value = true;\r\n  try {\r\n    const res = await submitAnswerApi({\r\n      questionId: question.value.id,\r\n      chosen,\r\n      timeSpent: question.value.duration || 20,\r\n    });\r\n    feedback.value = res;\r\n    uni.showToast({\r\n      title: res.isCorrect ? '回答正确' : '再接再厉',\r\n      icon: res.isCorrect ? 'success' : 'none',\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    uni.showToast({ title: '提交失败', icon: 'none' });\r\n  } finally {\r\n    submitting.value = false;\r\n  }\r\n};\r\n\r\nonLoad((options) => {\r\n  if (options?.id) {\r\n    loadData(options.id);\r\n  }\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.page {\r\n  padding: 20rpx;\r\n}\r\n\r\n.question-card {\r\n  border-radius: 18rpx;\r\n}\r\n\r\n.title {\r\n  font-size: 32rpx;\r\n  font-weight: 700;\r\n  line-height: 1.6;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12rpx;\r\n}\r\n\r\n.type-tag {\r\n  display: inline-flex;\r\n  padding: 4rpx 12rpx;\r\n  background: #eef2ff;\r\n  color: #4f46e5;\r\n  border-radius: 10rpx;\r\n  font-size: 22rpx;\r\n}\r\n\r\n.meta-row {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12rpx;\r\n  margin: 12rpx 0 8rpx;\r\n}\r\n\r\n.muted {\r\n  color: #6b7280;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.option-area {\r\n  margin-top: 12rpx;\r\n}\r\n\r\n.short-input {\r\n  width: 100%;\r\n  min-height: 160rpx;\r\n  padding: 14rpx;\r\n  border-radius: 12rpx;\r\n  border: 2rpx solid #e5e7eb;\r\n  background: #f9fafb;\r\n  box-sizing: border-box;\r\n  font-size: 28rpx;\r\n  color: #1f2937;\r\n}\r\n\r\n.option {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 18rpx 16rpx;\r\n  border-radius: 14rpx;\r\n  background: #f9fafb;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.option-text {\r\n  margin-left: 12rpx;\r\n  font-size: 28rpx;\r\n  color: #1f2937;\r\n}\r\n\r\n.actions {\r\n  display: flex;\r\n  gap: 12rpx;\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.primary-btn {\r\n  flex: 1;\r\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\r\n  color: #fff;\r\n  border: none;\r\n}\r\n\r\n.ghost-btn {\r\n  flex: 1;\r\n  background: #fff;\r\n  color: #2563eb;\r\n  border: 2rpx solid #2563eb;\r\n}\r\n\r\n.result {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10rpx;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.result.correct {\r\n  color: #10b981;\r\n}\r\n\r\n.result.wrong {\r\n  color: #ef4444;\r\n}\r\n\r\n.answer-text {\r\n  font-weight: 600;\r\n  color: #111827;\r\n}\r\n\r\n.explain {\r\n  margin-top: 8rpx;\r\n  color: #1f2937;\r\n  line-height: 1.5;\r\n}\r\n\r\n.progress-info {\r\n  margin-top: 12rpx;\r\n  display: flex;\r\n  gap: 16rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/project/practice-app/practice-app-ui/pages/questions/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","fetchCategoryTree","fetchQuestionDetail","flattenCategoryTree","submitAnswerApi","onLoad"],"mappings":"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"}