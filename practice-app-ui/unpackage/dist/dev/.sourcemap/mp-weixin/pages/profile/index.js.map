{"version":3,"file":"index.js","sources":["pages/profile/index.vue","D:/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9pbmRleC52dWU"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <uni-card :is-shadow=\"false\" class=\"profile-card\">\n      <view class=\"profile-header\">\n        <image :src=\"user.avatar || '/static/uni.png'\" class=\"avatar\" mode=\"aspectFill\" />\n        <view class=\"info\">\n          <view class=\"nickname\">{{ user.nickname || '未登录' }}</view>\n          <view class=\"row\">\n            <uni-badge text=\"积分\" type=\"primary\" />\n            <text class=\"muted\"> {{ user.points || 0 }}</text>\n          </view>\n        </view>\n        <button size=\"mini\" type=\"primary\" class=\"login-btn\" @tap=\"handleWeixinLogin\">\n          {{ user.loggedIn ? '重新登录' : '微信登录' }}\n        </button>\n      </view>\n    </uni-card>\n\n    <uni-card title=\"个人信息\" :is-shadow=\"false\">\n      <uni-forms ref=\"formRef\" :modelValue=\"formModel\" :rules=\"rules\" label-position=\"top\">\n        <uni-forms-item label=\"昵称\" name=\"nickname\">\n          <uni-easyinput v-model=\"formModel.nickname\" placeholder=\"请输入昵称\" />\n        </uni-forms-item>\n        <uni-forms-item label=\"头像 URL\" name=\"avatar\">\n          <uni-easyinput v-model=\"formModel.avatar\" placeholder=\"可填写自定义头像链接\" />\n        </uni-forms-item>\n        <uni-forms-item label=\"密码\" name=\"password\">\n          <uni-easyinput type=\"password\" v-model=\"formModel.password\" placeholder=\"6-20 位新密码\" />\n        </uni-forms-item>\n      </uni-forms>\n      <button type=\"primary\" class=\"primary-btn\" @tap=\"handleSave\">保存修改</button>\n    </uni-card>\n\n    <uni-card title=\"学习进度\" :is-shadow=\"false\">\n      <view class=\"stats-row\">\n        <view class=\"stat\">\n          <text class=\"stat-num\">{{ progress.answeredQuestions }}</text>\n          <text class=\"muted\">已完成</text>\n        </view>\n        <view class=\"stat\">\n          <text class=\"stat-num\">{{ progress.totalQuestions }}</text>\n          <text class=\"muted\">总题量</text>\n        </view>\n        <view class=\"stat\">\n          <text class=\"stat-num\">{{ progress.correctRate }}%</text>\n          <text class=\"muted\">正确率</text>\n        </view>\n      </view>\n      <button class=\"ghost-btn\" @tap=\"goRecords\">查看答题记录</button>\n    </uni-card>\n  </view>\n</template>\n\n<script setup>\nimport { reactive, ref } from 'vue';\nimport { onShow } from '@dcloudio/uni-app';\nimport {\n  fetchCurrentUser,\n  fetchProgress,\n  loginWithWeixin,\n  updateUserProfile,\n} from '@/api/mock.js';\n\nconst user = ref({});\nconst progress = ref({\n  answeredQuestions: 0,\n  totalQuestions: 0,\n  correctRate: 0,\n});\n\nconst formModel = reactive({\n  nickname: '',\n  avatar: '',\n  password: '',\n});\n\nconst rules = {\n  nickname: {\n    rules: [{ required: true, errorMessage: '请输入昵称' }],\n  },\n  password: {\n    rules: [{ minLength: 6, errorMessage: '密码长度至少 6 位' }],\n  },\n};\n\nconst formRef = ref(null);\n\nconst loadData = async () => {\n  const [userInfo, progressInfo] = await Promise.all([fetchCurrentUser(), fetchProgress()]);\n  user.value = userInfo;\n  progress.value = progressInfo;\n  formModel.nickname = userInfo.nickname || '';\n  formModel.avatar = userInfo.avatar || '';\n  formModel.password = '';\n};\n\nconst handleWeixinLogin = async () => {\n  try {\n    uni.showLoading({ title: '登录中' });\n    if (uni.login) {\n      await new Promise((resolve) => {\n        uni.login({\n          provider: 'weixin',\n          success: resolve,\n          fail: resolve,\n        });\n      });\n    }\n    let profile = {};\n    if (uni.getUserProfile) {\n      const res = await uni.getUserProfile({ desc: '用于完善个人资料' });\n      profile = res.userInfo || {};\n    }\n    const info = await loginWithWeixin(profile);\n    user.value = info;\n    loadData();\n    uni.showToast({ title: '登录成功', icon: 'success' });\n  } catch (err) {\n    console.error(err);\n    uni.showToast({ title: '登录失败，稍后再试', icon: 'none' });\n  } finally {\n    uni.hideLoading();\n  }\n};\n\nconst handleSave = async () => {\n  if (!formRef.value) return;\n  try {\n    await formRef.value.validate();\n    const info = await updateUserProfile({\n      nickname: formModel.nickname,\n      avatar: formModel.avatar,\n      password: formModel.password,\n    });\n    user.value = info;\n    uni.showToast({ title: '保存成功', icon: 'success' });\n  } catch (err) {\n    if (err?.errMsg) {\n      uni.showToast({ title: err.errMsg, icon: 'none' });\n    } else {\n      uni.showToast({ title: '保存失败', icon: 'none' });\n    }\n  }\n};\n\nconst goRecords = () => {\n  uni.switchTab({ url: '/pages/records/index' });\n};\n\nonShow(() => {\n  loadData();\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.page {\n  padding: 20rpx;\n}\n\n.profile-card {\n  background: linear-gradient(135deg, #1f2937, #111827);\n  color: #fff;\n}\n\n.profile-header {\n  display: flex;\n  align-items: center;\n  gap: 16rpx;\n}\n\n.avatar {\n  width: 120rpx;\n  height: 120rpx;\n  border-radius: 50%;\n  border: 4rpx solid rgba(255, 255, 255, 0.3);\n}\n\n.info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 8rpx;\n}\n\n.nickname {\n  font-size: 32rpx;\n  font-weight: 700;\n}\n\n.row {\n  display: flex;\n  align-items: center;\n  gap: 10rpx;\n}\n\n.login-btn {\n  background: #2563eb;\n  color: #fff;\n}\n\n.primary-btn {\n  width: 100%;\n  margin-top: 12rpx;\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n}\n\n.ghost-btn {\n  width: 100%;\n  margin-top: 12rpx;\n  background: #f3f4f6;\n  color: #1f2937;\n}\n\n.stats-row {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 12rpx;\n  text-align: center;\n}\n\n.stat-num {\n  font-size: 32rpx;\n  font-weight: 700;\n}\n\n.muted {\n  color: #6b7280;\n}\n</style>\n","import MiniProgramPage from 'E:/javaproject/practice-app/practice-app-ui/pages/profile/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","fetchCurrentUser","fetchProgress","uni","loginWithWeixin","updateUserProfile","onShow"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AA+DA,UAAM,OAAOA,cAAAA,IAAI,CAAA,CAAE;AACnB,UAAM,WAAWA,cAAAA,IAAI;AAAA,MACnB,mBAAmB;AAAA,MACnB,gBAAgB;AAAA,MAChB,aAAa;AAAA,IACf,CAAC;AAED,UAAM,YAAYC,cAAAA,SAAS;AAAA,MACzB,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,UAAU;AAAA,IACZ,CAAC;AAED,UAAM,QAAQ;AAAA,MACZ,UAAU;AAAA,QACR,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,QAAO,CAAE;AAAA,MAClD;AAAA,MACD,UAAU;AAAA,QACR,OAAO,CAAC,EAAE,WAAW,GAAG,cAAc,aAAY,CAAE;AAAA,MACrD;AAAA,IACH;AAEA,UAAM,UAAUD,cAAAA,IAAI,IAAI;AAExB,UAAM,WAAW,YAAY;AAC3B,YAAM,CAAC,UAAU,YAAY,IAAI,MAAM,QAAQ,IAAI,CAACE,0BAAkB,GAAEC,uBAAe,CAAA,CAAC;AACxF,WAAK,QAAQ;AACb,eAAS,QAAQ;AACjB,gBAAU,WAAW,SAAS,YAAY;AAC1C,gBAAU,SAAS,SAAS,UAAU;AACtC,gBAAU,WAAW;AAAA,IACvB;AAEA,UAAM,oBAAoB,YAAY;AACpC,UAAI;AACFC,sBAAAA,MAAI,YAAY,EAAE,OAAO,MAAO,CAAA;AAChC,YAAIA,cAAAA,MAAI,OAAO;AACb,gBAAM,IAAI,QAAQ,CAAC,YAAY;AAC7BA,0BAAAA,MAAI,MAAM;AAAA,cACR,UAAU;AAAA,cACV,SAAS;AAAA,cACT,MAAM;AAAA,YAChB,CAAS;AAAA,UACT,CAAO;AAAA,QACF;AACD,YAAI,UAAU,CAAA;AACd,YAAIA,cAAAA,MAAI,gBAAgB;AACtB,gBAAM,MAAM,MAAMA,oBAAI,eAAe,EAAE,MAAM,WAAU,CAAE;AACzD,oBAAU,IAAI,YAAY;QAC3B;AACD,cAAM,OAAO,MAAMC,yBAAgB,OAAO;AAC1C,aAAK,QAAQ;AACb;AACAD,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAS,CAAE;AAAA,MACjD,SAAQ,KAAK;AACZA,sBAAAA,MAAA,MAAA,SAAA,kCAAc,GAAG;AACjBA,sBAAG,MAAC,UAAU,EAAE,OAAO,aAAa,MAAM,OAAM,CAAE;AAAA,MACtD,UAAY;AACRA,sBAAG,MAAC,YAAW;AAAA,MAChB;AAAA,IACH;AAEA,UAAM,aAAa,YAAY;AAC7B,UAAI,CAAC,QAAQ;AAAO;AACpB,UAAI;AACF,cAAM,QAAQ,MAAM;AACpB,cAAM,OAAO,MAAME,2BAAkB;AAAA,UACnC,UAAU,UAAU;AAAA,UACpB,QAAQ,UAAU;AAAA,UAClB,UAAU,UAAU;AAAA,QAC1B,CAAK;AACD,aAAK,QAAQ;AACbF,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAS,CAAE;AAAA,MACjD,SAAQ,KAAK;AACZ,YAAI,2BAAK,QAAQ;AACfA,8BAAI,UAAU,EAAE,OAAO,IAAI,QAAQ,MAAM,OAAM,CAAE;AAAA,QACvD,OAAW;AACLA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAAA,QAC9C;AAAA,MACF;AAAA,IACH;AAEA,UAAM,YAAY,MAAM;AACtBA,oBAAAA,MAAI,UAAU,EAAE,KAAK,uBAAwB,CAAA;AAAA,IAC/C;AAEAG,kBAAAA,OAAO,MAAM;AACX;IACF,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtJD,GAAG,WAAW,eAAe;"}