{"version":3,"file":"index.js","sources":["pages/profile/index.vue","../../../software/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9pbmRleC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <uni-card :is-shadow=\"false\" class=\"profile-card\">\r\n      <view class=\"profile-header\">\r\n        <image :src=\"user.avatar || '/static/uni.png'\" class=\"avatar\" mode=\"aspectFill\" />\r\n        <view class=\"info\">\r\n          <view class=\"nickname\">{{ user.nickname || '未登录' }}</view>\r\n          <view class=\"row\">\r\n            <uni-badge text=\"积分\" type=\"primary\" />\r\n            <text class=\"muted\"> {{ user.points || 0 }}</text>\r\n          </view>\r\n        </view>\r\n        <button size=\"mini\" type=\"primary\" class=\"login-btn\" @tap=\"handleWeixinLogin\">\r\n          {{ user.loggedIn ? '重新登录' : '微信登录' }}\r\n        </button>\r\n      </view>\r\n    </uni-card>\r\n\r\n    <uni-card title=\"个人信息\" :is-shadow=\"false\">\r\n      <uni-forms ref=\"formRef\" :modelValue=\"formModel\" :rules=\"rules\" label-position=\"top\">\r\n        <uni-forms-item label=\"昵称\" name=\"nickname\">\r\n          <uni-easyinput v-model=\"formModel.nickname\" placeholder=\"请输入昵称\" />\r\n        </uni-forms-item>\r\n        <uni-forms-item label=\"头像 URL\" name=\"avatar\">\r\n          <uni-easyinput v-model=\"formModel.avatar\" placeholder=\"可填写自定义头像链接\" />\r\n        </uni-forms-item>\r\n        <uni-forms-item label=\"密码\" name=\"password\">\r\n          <uni-easyinput type=\"password\" v-model=\"formModel.password\" placeholder=\"6-20 位新密码\" />\r\n        </uni-forms-item>\r\n      </uni-forms>\r\n      <button type=\"primary\" class=\"primary-btn\" @tap=\"handleSave\">保存修改</button>\r\n    </uni-card>\r\n\r\n    <uni-card title=\"学习进度\" :is-shadow=\"false\">\r\n      <view class=\"stats-row\">\r\n        <view class=\"stat\">\r\n          <text class=\"stat-num\">{{ progress.answeredQuestions }}</text>\r\n          <text class=\"muted\">已完成</text>\r\n        </view>\r\n        <view class=\"stat\">\r\n          <text class=\"stat-num\">{{ progress.totalQuestions }}</text>\r\n          <text class=\"muted\">总题量</text>\r\n        </view>\r\n        <view class=\"stat\">\r\n          <text class=\"stat-num\">{{ progress.correctRate }}%</text>\r\n          <text class=\"muted\">正确率</text>\r\n        </view>\r\n      </view>\r\n      <button class=\"ghost-btn\" @tap=\"goRecords\">查看答题记录</button>\r\n    </uni-card>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { reactive, ref } from 'vue';\r\nimport { onShow } from '@dcloudio/uni-app';\r\nimport {\r\n  fetchCurrentUser,\r\n  fetchProgress,\r\n  loginWithWeixin,\r\n  updateUserProfile,\r\n} from '@/api/mock.js';\r\n\r\nconst user = ref({});\r\nconst progress = ref({\r\n  answeredQuestions: 0,\r\n  totalQuestions: 0,\r\n  correctRate: 0,\r\n});\r\n\r\nconst formModel = reactive({\r\n  nickname: '',\r\n  avatar: '',\r\n  password: '',\r\n});\r\n\r\nconst rules = {\r\n  nickname: {\r\n    rules: [{ required: true, errorMessage: '请输入昵称' }],\r\n  },\r\n  password: {\r\n    rules: [{ minLength: 6, errorMessage: '密码长度至少 6 位' }],\r\n  },\r\n};\r\n\r\nconst formRef = ref(null);\r\n\r\nconst loadData = async () => {\r\n  const [userInfo, progressInfo] = await Promise.all([fetchCurrentUser(), fetchProgress()]);\r\n  user.value = userInfo;\r\n  progress.value = progressInfo;\r\n  formModel.nickname = userInfo.nickname || '';\r\n  formModel.avatar = userInfo.avatar || '';\r\n  formModel.password = '';\r\n};\r\n\r\nconst handleWeixinLogin = async () => {\r\n  try {\r\n    uni.showLoading({ title: '登录中' });\r\n    if (uni.login) {\r\n      await new Promise((resolve) => {\r\n        uni.login({\r\n          provider: 'weixin',\r\n          success: resolve,\r\n          fail: resolve,\r\n        });\r\n      });\r\n    }\r\n    let profile = {};\r\n    if (uni.getUserProfile) {\r\n      const res = await uni.getUserProfile({ desc: '用于完善个人资料' });\r\n      profile = res.userInfo || {};\r\n    }\r\n    const info = await loginWithWeixin(profile);\r\n    user.value = info;\r\n    loadData();\r\n    uni.showToast({ title: '登录成功', icon: 'success' });\r\n  } catch (err) {\r\n    console.error(err);\r\n    uni.showToast({ title: '登录失败，稍后再试', icon: 'none' });\r\n  } finally {\r\n    uni.hideLoading();\r\n  }\r\n};\r\n\r\nconst handleSave = async () => {\r\n  if (!formRef.value) return;\r\n  try {\r\n    await formRef.value.validate();\r\n    const info = await updateUserProfile({\r\n      nickname: formModel.nickname,\r\n      avatar: formModel.avatar,\r\n      password: formModel.password,\r\n    });\r\n    user.value = info;\r\n    uni.showToast({ title: '保存成功', icon: 'success' });\r\n  } catch (err) {\r\n    if (err?.errMsg) {\r\n      uni.showToast({ title: err.errMsg, icon: 'none' });\r\n    } else {\r\n      uni.showToast({ title: '保存失败', icon: 'none' });\r\n    }\r\n  }\r\n};\r\n\r\nconst goRecords = () => {\r\n  uni.switchTab({ url: '/pages/records/index' });\r\n};\r\n\r\nonShow(() => {\r\n  loadData();\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.page {\r\n  padding: 20rpx;\r\n}\r\n\r\n.profile-card {\r\n  background: linear-gradient(135deg, #1f2937, #111827);\r\n  color: #fff;\r\n}\r\n\r\n.profile-header {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 16rpx;\r\n}\r\n\r\n.avatar {\r\n  width: 120rpx;\r\n  height: 120rpx;\r\n  border-radius: 50%;\r\n  border: 4rpx solid rgba(255, 255, 255, 0.3);\r\n}\r\n\r\n.info {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8rpx;\r\n}\r\n\r\n.nickname {\r\n  font-size: 32rpx;\r\n  font-weight: 700;\r\n}\r\n\r\n.row {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10rpx;\r\n}\r\n\r\n.login-btn {\r\n  background: #2563eb;\r\n  color: #fff;\r\n}\r\n\r\n.primary-btn {\r\n  width: 100%;\r\n  margin-top: 12rpx;\r\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\r\n}\r\n\r\n.ghost-btn {\r\n  width: 100%;\r\n  margin-top: 12rpx;\r\n  background: #f3f4f6;\r\n  color: #1f2937;\r\n}\r\n\r\n.stats-row {\r\n  display: grid;\r\n  grid-template-columns: repeat(3, 1fr);\r\n  gap: 12rpx;\r\n  text-align: center;\r\n}\r\n\r\n.stat-num {\r\n  font-size: 32rpx;\r\n  font-weight: 700;\r\n}\r\n\r\n.muted {\r\n  color: #6b7280;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'H:/JavaProject/practice-app/practice-app-ui/pages/profile/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","fetchCurrentUser","fetchProgress","uni","loginWithWeixin","updateUserProfile","onShow"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AA+DA,UAAM,OAAOA,cAAAA,IAAI,CAAA,CAAE;AACnB,UAAM,WAAWA,cAAAA,IAAI;AAAA,MACnB,mBAAmB;AAAA,MACnB,gBAAgB;AAAA,MAChB,aAAa;AAAA,IACf,CAAC;AAED,UAAM,YAAYC,cAAAA,SAAS;AAAA,MACzB,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,UAAU;AAAA,IACZ,CAAC;AAED,UAAM,QAAQ;AAAA,MACZ,UAAU;AAAA,QACR,OAAO,CAAC,EAAE,UAAU,MAAM,cAAc,QAAO,CAAE;AAAA,MAClD;AAAA,MACD,UAAU;AAAA,QACR,OAAO,CAAC,EAAE,WAAW,GAAG,cAAc,aAAY,CAAE;AAAA,MACrD;AAAA,IACH;AAEA,UAAM,UAAUD,cAAAA,IAAI,IAAI;AAExB,UAAM,WAAW,YAAY;AAC3B,YAAM,CAAC,UAAU,YAAY,IAAI,MAAM,QAAQ,IAAI,CAACE,0BAAkB,GAAEC,uBAAe,CAAA,CAAC;AACxF,WAAK,QAAQ;AACb,eAAS,QAAQ;AACjB,gBAAU,WAAW,SAAS,YAAY;AAC1C,gBAAU,SAAS,SAAS,UAAU;AACtC,gBAAU,WAAW;AAAA,IACvB;AAEA,UAAM,oBAAoB,YAAY;AACpC,UAAI;AACFC,sBAAAA,MAAI,YAAY,EAAE,OAAO,MAAO,CAAA;AAChC,YAAIA,cAAAA,MAAI,OAAO;AACb,gBAAM,IAAI,QAAQ,CAAC,YAAY;AAC7BA,0BAAAA,MAAI,MAAM;AAAA,cACR,UAAU;AAAA,cACV,SAAS;AAAA,cACT,MAAM;AAAA,YAChB,CAAS;AAAA,UACT,CAAO;AAAA,QACF;AACD,YAAI,UAAU,CAAA;AACd,YAAIA,cAAAA,MAAI,gBAAgB;AACtB,gBAAM,MAAM,MAAMA,oBAAI,eAAe,EAAE,MAAM,WAAU,CAAE;AACzD,oBAAU,IAAI,YAAY;QAC3B;AACD,cAAM,OAAO,MAAMC,yBAAgB,OAAO;AAC1C,aAAK,QAAQ;AACb;AACAD,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAS,CAAE;AAAA,MACjD,SAAQ,KAAK;AACZA,sBAAAA,MAAA,MAAA,SAAA,kCAAc,GAAG;AACjBA,sBAAG,MAAC,UAAU,EAAE,OAAO,aAAa,MAAM,OAAM,CAAE;AAAA,MACtD,UAAY;AACRA,sBAAG,MAAC,YAAW;AAAA,MAChB;AAAA,IACH;AAEA,UAAM,aAAa,YAAY;AAC7B,UAAI,CAAC,QAAQ;AAAO;AACpB,UAAI;AACF,cAAM,QAAQ,MAAM;AACpB,cAAM,OAAO,MAAME,2BAAkB;AAAA,UACnC,UAAU,UAAU;AAAA,UACpB,QAAQ,UAAU;AAAA,UAClB,UAAU,UAAU;AAAA,QAC1B,CAAK;AACD,aAAK,QAAQ;AACbF,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAS,CAAE;AAAA,MACjD,SAAQ,KAAK;AACZ,YAAI,2BAAK,QAAQ;AACfA,8BAAI,UAAU,EAAE,OAAO,IAAI,QAAQ,MAAM,OAAM,CAAE;AAAA,QACvD,OAAW;AACLA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAAA,QAC9C;AAAA,MACF;AAAA,IACH;AAEA,UAAM,YAAY,MAAM;AACtBA,oBAAAA,MAAI,UAAU,EAAE,KAAK,uBAAwB,CAAA;AAAA,IAC/C;AAEAG,kBAAAA,OAAO,MAAM;AACX;IACF,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtJD,GAAG,WAAW,eAAe;"}