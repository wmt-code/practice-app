{"version":3,"file":"index.js","sources":["pages/home/index.vue","D:/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9pbmRleC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <uni-card :is-shadow=\"false\" class=\"hero-card\">\r\n      <view class=\"hero\">\r\n        <image :src=\"user.avatar || '/static/uni.png'\" class=\"avatar\" mode=\"aspectFill\" />\r\n        <view class=\"hero-info\">\r\n          <view class=\"title-row\">\r\n            <text class=\"nickname\">{{ user.nickname || '未登录' }}</text>\r\n            <uni-badge v-if=\"user.loggedIn\" text=\"已登录\" type=\"success\" />\r\n          </view>\r\n          <view class=\"meta\">\r\n            <text class=\"meta-text\">已完成 {{ progress.answeredQuestions }}/{{ progress.totalQuestions }}</text>\r\n          </view>\r\n        </view>\r\n        <button v-if=\"!user.loggedIn\" class=\"login-btn\" size=\"mini\" type=\"primary\" @tap=\"goProfile\">\r\n          去登录\r\n        </button>\r\n      </view>\r\n      <view class=\"progress-block\">\r\n        <view class=\"progress-header\">\r\n          <text class=\"muted\">学习进度</text>\r\n          <text class=\"muted\">正确率 {{ progress.correctRate || 0 }}%</text>\r\n        </view>\r\n        <progress :percent=\"progress.percent || 0\" active stroke-width=\"8\" />\r\n        <view class=\"progress-footer\">\r\n          <text class=\"muted\">已做 {{ progress.answeredQuestions }} / {{ progress.totalQuestions }}</text>\r\n        </view>\r\n      </view>\r\n    </uni-card>\r\n\r\n    <uni-section title=\"分类进度\" type=\"line\" padding />\r\n    <view class=\"category-grid\">\r\n      <view v-for=\"cat in progress.categories\" :key=\"cat.id\" class=\"section-card\">\r\n        <view class=\"row\">\r\n          <text class=\"cat-name\">{{ cat.name }}</text>\r\n          <uni-badge :text=\"cat.correct + '/' + cat.total\" type=\"primary\" />\r\n        </view>\r\n        <text class=\"muted\">正确率 {{ cat.correctRate }}%</text>\r\n        <progress\r\n          :percent=\"cat.total ? Math.round((cat.answered / cat.total) * 100) : 0\"\r\n          active\r\n          stroke-width=\"6\"\r\n        />\r\n      </view>\r\n    </view>\r\n\r\n    <uni-section title=\"推荐题目\" sub-title=\"从未做过的题目里精选\" type=\"line\" padding />\r\n    <view v-if=\"recommended.length\">\r\n      <uni-card\r\n        v-for=\"item in recommended\"\r\n        :key=\"item.id\"\r\n        :is-shadow=\"false\"\r\n        class=\"section-card\"\r\n        :title=\"item.title\"\r\n        @click=\"goQuestion(item.id)\"\r\n      >\r\n        <view class=\"tag-row\">\r\n          <uni-tag :text=\"renderType(item.type)\" size=\"mini\" type=\"primary\" />\r\n          <uni-tag\r\n            v-if=\"item.difficulty\"\r\n            :text=\"renderDifficulty(item.difficulty)\"\r\n            size=\"mini\"\r\n            type=\"warning\"\r\n          />\r\n          <uni-tag :text=\"getCategoryName(item.categoryId)\" size=\"mini\" type=\"success\" />\r\n          <text class=\"muted ml-auto\">分值 {{ item.score }}</text>\r\n        </view>\r\n      </uni-card>\r\n    </view>\r\n    <view v-else class=\"empty\">\r\n      <text class=\"muted\">暂无推荐题目，先去题库看看吧</text>\r\n    </view>\r\n\r\n    <view class=\"cta\">\r\n      <button type=\"primary\" class=\"primary-btn\" @tap=\"goQuestionBank\">进入题库</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport { onPullDownRefresh, onShow } from '@dcloudio/uni-app';\r\nimport { fetchCategoryTree, flattenCategoryTree, categoryNameById } from '@/api/categories.js';\r\nimport { fetchPracticeRandom } from '@/api/questions.js';\r\nimport { fetchProfile, getCachedProfile } from '@/api/user';\r\nimport { emptyProgress, fetchProgressSummary } from '@/api/progress';\r\n\r\nconst fallbackUser = () =>\n  getCachedProfile() || {\n    nickname: '未登录',\n    avatar: '/static/uni.png',\n    loggedIn: false,\n  };\n\r\nconst user = ref(fallbackUser());\r\nconst progress = ref(emptyProgress());\r\nconst recommended = ref([]);\r\nconst categories = ref([]);\r\nconst categoryTree = ref([]);\r\n\r\nconst loadData = async () => {\r\n  const [userResult, progressResult, catTreeRes, recommendList] = await Promise.allSettled([\r\n    fetchProfile(),\r\n    fetchProgressSummary(),\r\n    fetchCategoryTree(),\r\n    fetchPracticeRandom({ limit: 3 }),\r\n  ]);\r\n  user.value =\r\n    userResult.status === 'fulfilled' && userResult.value ? userResult.value : fallbackUser();\r\n  progress.value =\r\n    progressResult.status === 'fulfilled' && progressResult.value\r\n      ? progressResult.value\r\n      : emptyProgress();\r\n  categoryTree.value = catTreeRes.status === 'fulfilled' ? catTreeRes.value : [];\r\n  categories.value =\r\n    catTreeRes.status === 'fulfilled' && Array.isArray(catTreeRes.value)\r\n      ? flattenCategoryTree(catTreeRes.value)\r\n      : [];\r\n  recommended.value = recommendList.status === 'fulfilled' ? recommendList.value : [];\r\n};\r\n\r\nconst renderType = (type) => {\r\n  const text = String(type || '');\r\n  const lower = text.toLowerCase();\r\n  if (lower.includes('multiple') || text.includes('多选')) return '多选';\r\n  if (lower.includes('true') || lower.includes('judge') || text.includes('判断') || text.includes('是非')) {\r\n    return '判断';\r\n  }\r\n  if (lower.includes('fill') || lower.includes('short') || text.includes('填空') || text.includes('简答')) {\r\n    return '简答';\r\n  }\r\n  return '单选';\r\n};\r\n\r\nconst getCategoryName = (id) => categoryNameById(categories.value, id) || '未分类';\r\n\r\nconst renderDifficulty = (difficulty) => {\r\n  if (!difficulty) return '不限难度';\r\n  if (difficulty === 'HARD') return '困难';\r\n  if (difficulty === 'MEDIUM') return '中等';\r\n  if (difficulty === 'EASY') return '容易';\r\n  return difficulty;\r\n};\r\n\r\nconst goQuestionBank = () => {\r\n  uni.switchTab({ url: '/pages/questions/index' });\r\n};\r\n\r\nconst goQuestion = (id) => {\r\n  uni.navigateTo({ url: `/pages/questions/detail?id=${id}` });\r\n};\r\n\r\nconst goProfile = () => {\r\n  uni.switchTab({ url: '/pages/profile/index' });\r\n};\r\n\r\nonShow(() => {\r\n  loadData();\r\n});\r\n\r\nonPullDownRefresh(async () => {\r\n  await loadData();\r\n  uni.stopPullDownRefresh();\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.page {\r\n  padding: 24rpx;\r\n}\r\n\r\n.hero-card {\r\n  background: linear-gradient(135deg, #2563eb, #60a5fa);\r\n  color: #fff;\r\n  border: none;\r\n}\r\n\r\n.hero {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 20rpx;\r\n}\r\n\r\n.avatar {\r\n  width: 120rpx;\r\n  height: 120rpx;\r\n  border-radius: 50%;\r\n  border: 4rpx solid rgba(255, 255, 255, 0.4);\r\n}\r\n\r\n.hero-info {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8rpx;\r\n}\r\n\r\n.title-row {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12rpx;\r\n}\r\n\r\n.nickname {\r\n  font-size: 34rpx;\r\n  font-weight: 700;\r\n}\r\n\r\n.meta {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8rpx;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.meta-text {\r\n  font-size: 24rpx;\r\n  color: rgba(255, 255, 255, 0.9);\r\n}\r\n\r\n.login-btn {\r\n  margin-left: 12rpx;\r\n}\r\n\r\n.progress-block {\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.progress-header,\r\n.progress-footer {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  font-size: 24rpx;\r\n  margin: 6rpx 0;\r\n}\r\n\r\n.muted {\r\n  color: #9ca3af;\r\n}\r\n\r\n.section-card {\r\n  border-radius: 16rpx;\r\n}\r\n\r\n.category-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(300rpx, 1fr));\r\n  gap: 16rpx;\r\n}\r\n\r\n.row {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  margin-bottom: 8rpx;\r\n}\r\n\r\n.cat-name {\r\n  font-weight: 600;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.tag-row {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12rpx;\r\n  margin-top: 12rpx;\r\n}\r\n\r\n.ml-auto {\r\n  margin-left: auto;\r\n}\r\n\r\n.cta {\r\n  margin: 32rpx 0;\r\n}\r\n\r\n.primary-btn {\r\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\r\n  color: #fff;\r\n  border: none;\r\n}\r\n\r\n.empty {\r\n  padding: 20rpx;\r\n  text-align: center;\r\n}\r\n\r\n.mr-8 {\r\n  margin-right: 8rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/project/practice-app/practice-app-ui/pages/home/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCachedProfile","ref","emptyProgress","fetchProfile","fetchProgressSummary","fetchCategoryTree","fetchPracticeRandom","flattenCategoryTree","categoryNameById","uni","onShow","onPullDownRefresh"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuFA,UAAM,eAAe,MACnBA,SAAAA,sBAAsB;AAAA,MACpB,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,UAAU;AAAA,IACd;AAEA,UAAM,OAAOC,cAAAA,IAAI,aAAY,CAAE;AAC/B,UAAM,WAAWA,cAAAA,IAAIC,aAAa,cAAA,CAAE;AACpC,UAAM,cAAcD,cAAAA,IAAI,CAAA,CAAE;AAC1B,UAAM,aAAaA,cAAAA,IAAI,CAAA,CAAE;AACzB,UAAM,eAAeA,cAAAA,IAAI,CAAA,CAAE;AAE3B,UAAM,WAAW,YAAY;AAC3B,YAAM,CAAC,YAAY,gBAAgB,YAAY,aAAa,IAAI,MAAM,QAAQ,WAAW;AAAA,QACvFE,sBAAc;AAAA,QACdC,kCAAsB;AAAA,QACtBC,iCAAmB;AAAA,QACnBC,kCAAoB,EAAE,OAAO,GAAG;AAAA,MACpC,CAAG;AACD,WAAK,QACH,WAAW,WAAW,eAAe,WAAW,QAAQ,WAAW,QAAQ;AAC7E,eAAS,QACP,eAAe,WAAW,eAAe,eAAe,QACpD,eAAe,QACfJ,aAAAA;AACN,mBAAa,QAAQ,WAAW,WAAW,cAAc,WAAW,QAAQ;AAC5E,iBAAW,QACT,WAAW,WAAW,eAAe,MAAM,QAAQ,WAAW,KAAK,IAC/DK,eAAmB,oBAAC,WAAW,KAAK,IACpC;AACN,kBAAY,QAAQ,cAAc,WAAW,cAAc,cAAc,QAAQ;IACnF;AAEA,UAAM,aAAa,CAAC,SAAS;AAC3B,YAAM,OAAO,OAAO,QAAQ,EAAE;AAC9B,YAAM,QAAQ,KAAK;AACnB,UAAI,MAAM,SAAS,UAAU,KAAK,KAAK,SAAS,IAAI;AAAG,eAAO;AAC9D,UAAI,MAAM,SAAS,MAAM,KAAK,MAAM,SAAS,OAAO,KAAK,KAAK,SAAS,IAAI,KAAK,KAAK,SAAS,IAAI,GAAG;AACnG,eAAO;AAAA,MACR;AACD,UAAI,MAAM,SAAS,MAAM,KAAK,MAAM,SAAS,OAAO,KAAK,KAAK,SAAS,IAAI,KAAK,KAAK,SAAS,IAAI,GAAG;AACnG,eAAO;AAAA,MACR;AACD,aAAO;AAAA,IACT;AAEA,UAAM,kBAAkB,CAAC,OAAOC,eAAgB,iBAAC,WAAW,OAAO,EAAE,KAAK;AAE1E,UAAM,mBAAmB,CAAC,eAAe;AACvC,UAAI,CAAC;AAAY,eAAO;AACxB,UAAI,eAAe;AAAQ,eAAO;AAClC,UAAI,eAAe;AAAU,eAAO;AACpC,UAAI,eAAe;AAAQ,eAAO;AAClC,aAAO;AAAA,IACT;AAEA,UAAM,iBAAiB,MAAM;AAC3BC,oBAAAA,MAAI,UAAU,EAAE,KAAK,yBAA0B,CAAA;AAAA,IACjD;AAEA,UAAM,aAAa,CAAC,OAAO;AACzBA,oBAAG,MAAC,WAAW,EAAE,KAAK,8BAA8B,EAAE,GAAE,CAAE;AAAA,IAC5D;AAEA,UAAM,YAAY,MAAM;AACtBA,oBAAAA,MAAI,UAAU,EAAE,KAAK,uBAAwB,CAAA;AAAA,IAC/C;AAEAC,kBAAAA,OAAO,MAAM;AACX;IACF,CAAC;AAEDC,kBAAAA,kBAAkB,YAAY;AAC5B,YAAM,SAAQ;AACdF,oBAAG,MAAC,oBAAmB;AAAA,IACzB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClKD,GAAG,WAAW,eAAe;"}