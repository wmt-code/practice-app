{"version":3,"file":"index.js","sources":["pages/home/index.vue","D:/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaG9tZS9pbmRleC52dWU"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <uni-card :is-shadow=\"false\" class=\"hero-card\">\n      <view class=\"hero\">\n        <image :src=\"user.avatar || '/static/uni.png'\" class=\"avatar\" mode=\"aspectFill\" />\n        <view class=\"hero-info\">\n          <view class=\"title-row\">\n            <text class=\"nickname\">{{ user.nickname || '未登录' }}</text>\n            <uni-badge v-if=\"user.loggedIn\" text=\"已登录\" type=\"success\" />\n          </view>\n          <view class=\"meta\">\n            <text class=\"meta-text\">已完成 {{ progress.answeredQuestions }}/{{ progress.totalQuestions }}</text>\n          </view>\n        </view>\n        <button v-if=\"!user.loggedIn\" class=\"login-btn\" size=\"mini\" type=\"primary\" @tap=\"goProfile\">\n          去登录\n        </button>\n      </view>\n      <view class=\"progress-block\">\n        <view class=\"progress-header\">\n          <text class=\"muted\">学习进度</text>\n          <text class=\"muted\">正确率 {{ progress.correctRate || 0 }}%</text>\n        </view>\n        <progress :percent=\"progress.percent || 0\" active stroke-width=\"8\" />\n        <view class=\"progress-footer\">\n          <text class=\"muted\">已做 {{ progress.answeredQuestions }} / {{ progress.totalQuestions }}</text>\n        </view>\n      </view>\n    </uni-card>\n\n    <uni-section title=\"分类进度\" type=\"line\" padding />\n    <view class=\"category-grid\">\n      <view v-for=\"cat in progress.categories\" :key=\"cat.id\" class=\"section-card\">\n        <view class=\"row\">\n          <text class=\"cat-name\">{{ cat.name }}</text>\n          <uni-badge :text=\"cat.correct + '/' + cat.total\" type=\"primary\" />\n        </view>\n        <text class=\"muted\">正确率 {{ cat.correctRate }}%</text>\n        <progress\n          :percent=\"cat.total ? Math.round((cat.answered / cat.total) * 100) : 0\"\n          active\n          stroke-width=\"6\"\n        />\n      </view>\n    </view>\n\n    <uni-section title=\"推荐题目\" sub-title=\"从未做过的题目里精选\" type=\"line\" padding />\n    <view v-if=\"recommended.length\">\n      <uni-card\n        v-for=\"item in recommended\"\n        :key=\"item.id\"\n        :is-shadow=\"false\"\n        class=\"section-card\"\n        :title=\"item.title\"\n        @click=\"goQuestion(item.id)\"\n      >\n        <view class=\"tag-row\">\n          <uni-tag :text=\"renderType(item.type)\" size=\"mini\" type=\"primary\" />\n          <uni-tag\n            v-if=\"item.difficulty\"\n            :text=\"renderDifficulty(item.difficulty)\"\n            size=\"mini\"\n            type=\"warning\"\n          />\n          <uni-tag :text=\"getCategoryName(item.categoryId)\" size=\"mini\" type=\"success\" />\n          <text class=\"muted ml-auto\">分值 {{ item.score }}</text>\n        </view>\n      </uni-card>\n    </view>\n    <view v-else class=\"empty\">\n      <text class=\"muted\">暂无推荐题目，先去题库看看吧</text>\n    </view>\n\n    <view class=\"cta\">\n      <button class=\"secondary-btn\" @tap=\"openImportSheet\">题库导入</button>\n      <button type=\"primary\" class=\"primary-btn\" @tap=\"goQuestionBank\">进入题库</button>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref } from 'vue';\nimport { onPullDownRefresh, onShow } from '@dcloudio/uni-app';\nimport { fetchCategoryTree, flattenCategoryTree, categoryNameById } from '@/api/categories.js';\nimport { fetchPracticeRandom } from '@/api/questions.js';\nimport { fetchProfile, getCachedProfile } from '@/api/user';\nimport { emptyProgress, fetchProgressSummary } from '@/api/progress';\n\nconst fallbackUser = () =>\n  getCachedProfile() || {\n    nickname: '未登录',\n    avatar: '/static/uni.png',\n    loggedIn: false,\n  };\n\nconst user = ref(fallbackUser());\nconst progress = ref(emptyProgress());\nconst recommended = ref([]);\nconst categories = ref([]);\nconst categoryTree = ref([]);\n\nconst loadData = async () => {\n  const [userResult, progressResult, catTreeRes, recommendList] = await Promise.allSettled([\n    fetchProfile(),\n    fetchProgressSummary(),\n    fetchCategoryTree(),\n    fetchPracticeRandom({ limit: 3 }),\n  ]);\n  user.value =\n    userResult.status === 'fulfilled' && userResult.value ? userResult.value : fallbackUser();\n  progress.value =\n    progressResult.status === 'fulfilled' && progressResult.value\n      ? progressResult.value\n      : emptyProgress();\n  categoryTree.value = catTreeRes.status === 'fulfilled' ? catTreeRes.value : [];\n  categories.value =\n    catTreeRes.status === 'fulfilled' && Array.isArray(catTreeRes.value)\n      ? flattenCategoryTree(catTreeRes.value)\n      : [];\n  recommended.value = recommendList.status === 'fulfilled' ? recommendList.value : [];\n};\n\nconst renderType = (type) => {\n  const text = String(type || '');\n  const lower = text.toLowerCase();\n  if (lower.includes('multiple') || text.includes('多选')) return '多选';\n  if (lower.includes('true') || lower.includes('judge') || text.includes('判断') || text.includes('是非')) {\n    return '判断';\n  }\n  if (lower.includes('fill') || lower.includes('short') || text.includes('填空') || text.includes('简答')) {\n    return '简答';\n  }\n  return '单选';\n};\n\nconst getCategoryName = (id) => categoryNameById(categories.value, id) || '未分类';\n\nconst renderDifficulty = (difficulty) => {\n  if (!difficulty) return '不限难度';\n  if (difficulty === 'HARD') return '困难';\n  if (difficulty === 'MEDIUM') return '中等';\n  if (difficulty === 'EASY') return '容易';\n  return difficulty;\n};\n\nconst goQuestionBank = () => {\n  uni.switchTab({ url: '/pages/questions/index' });\n};\n\nconst goQuestion = (id) => {\n  uni.navigateTo({ url: `/pages/questions/detail?id=${id}` });\n};\n\nconst goProfile = () => {\n  uni.switchTab({ url: '/pages/profile/index' });\n};\n\nconst openImportSheet = () => {\n  uni.showActionSheet({\n    itemList: ['单题录入', '批量录入', '文件录入'],\n    success: (res) => {\n      if (res.tapIndex === 0) goImport('single');\n      if (res.tapIndex === 1) goImport('batch');\n      if (res.tapIndex === 2) goImport('file');\n    },\n  });\n};\n\nconst goImport = (mode) => {\n  if (mode === 'batch') {\n    uni.navigateTo({ url: '/pages/import-batch/index' });\n    return;\n  }\n  if (mode === 'file') {\n    uni.navigateTo({ url: '/pages/import-file/index' });\n    return;\n  }\n  uni.navigateTo({ url: `/pages/import-question/index?mode=${mode}` });\n};\n\nonShow(() => {\n  loadData();\n});\n\nonPullDownRefresh(async () => {\n  await loadData();\n  uni.stopPullDownRefresh();\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.page {\n  padding: 24rpx;\n}\n\n.hero-card {\n  background: linear-gradient(135deg, #2563eb, #60a5fa);\n  color: #fff;\n  border: none;\n}\n\n.hero {\n  display: flex;\n  align-items: center;\n  gap: 20rpx;\n}\n\n.avatar {\n  width: 120rpx;\n  height: 120rpx;\n  border-radius: 50%;\n  border: 4rpx solid rgba(255, 255, 255, 0.4);\n}\n\n.hero-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 8rpx;\n}\n\n.title-row {\n  display: flex;\n  align-items: center;\n  gap: 12rpx;\n}\n\n.nickname {\n  font-size: 34rpx;\n  font-weight: 700;\n}\n\n.meta {\n  display: flex;\n  align-items: center;\n  gap: 8rpx;\n  font-size: 24rpx;\n}\n\n.meta-text {\n  font-size: 24rpx;\n  color: rgba(255, 255, 255, 0.9);\n}\n\n.login-btn {\n  margin-left: 12rpx;\n}\n\n.progress-block {\n  margin-top: 20rpx;\n}\n\n.progress-header,\n.progress-footer {\n  display: flex;\n  justify-content: space-between;\n  font-size: 24rpx;\n  margin: 6rpx 0;\n}\n\n.muted {\n  color: #9ca3af;\n}\n\n.section-card {\n  border-radius: 16rpx;\n}\n\n.category-grid {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(300rpx, 1fr));\n  gap: 16rpx;\n}\n\n.row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 8rpx;\n}\n\n.cat-name {\n  font-weight: 600;\n  font-size: 28rpx;\n}\n\n.tag-row {\n  display: flex;\n  align-items: center;\n  gap: 12rpx;\n  margin-top: 12rpx;\n}\n\n.ml-auto {\n  margin-left: auto;\n}\n\n.cta {\n  margin: 32rpx 0;\n  display: flex;\n  gap: 16rpx;\n}\n\n.primary-btn {\n  flex: 1;\n  background: linear-gradient(135deg, #2563eb, #1d4ed8);\n  color: #fff;\n  border: none;\n}\n\n.secondary-btn {\n  flex: 1;\n  background: #eef2ff;\n  color: #1f2937;\n  border: 1rpx solid #e0e7ff;\n}\n\n.empty {\n  padding: 20rpx;\n  text-align: center;\n}\n\n.mr-8 {\n  margin-right: 8rpx;\n}\n</style>\n","import MiniProgramPage from 'E:/project/practice-app/practice-app-ui/pages/home/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCachedProfile","ref","emptyProgress","fetchProfile","fetchProgressSummary","fetchCategoryTree","fetchPracticeRandom","flattenCategoryTree","categoryNameById","uni","onShow","onPullDownRefresh"],"mappings":"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"}