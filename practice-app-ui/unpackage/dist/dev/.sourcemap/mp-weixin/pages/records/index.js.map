{"version":3,"file":"index.js","sources":["pages/records/index.vue","D:/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcmVjb3Jkcy9pbmRleC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <view class=\"filter\">\r\n      <picker mode=\"selector\" :range=\"categoryNames\" @change=\"onCategoryChange\">\r\n        <view class=\"picker\">\r\n          <text class=\"muted\">分类筛选：</text>\r\n          <text>{{ currentCategoryLabel }}</text>\r\n        </view>\r\n      </picker>\r\n    </view>\r\n\r\n    <view v-if=\"filteredRecords.length\">\n      <uni-card\n        v-for=\"item in filteredRecords\"\n        :key=\"item.questionId + '-' + item.answeredAt\"\n        :is-shadow=\"false\"\n        class=\"record-card\"\n        :title=\"item.questionTitle || '未知题目'\"\n      >\n        <view class=\"row\">\n          <uni-tag\n            :text=\"item.isCorrect ? '正确' : '错误'\"\n            :type=\"item.isCorrect ? 'success' : 'warning'\"\n          />\n          <uni-tag\n            v-if=\"item.difficulty\"\n            :text=\"renderDifficulty(item.difficulty)\"\n            size=\"small\"\n            type=\"primary\"\n          />\n          <text class=\"muted\">得分 {{ item.score }}</text>\n          <text class=\"muted\">用时 {{ item.timeSpent }}s</text>\n        </view>\n        <view class=\"row\">\n          <text class=\"muted\">提交：{{ formatTime(item.answeredAt) }}</text>\n          <text class=\"muted\">分类：{{ item.categoryName || getCategoryName(item.categoryId) }}</text>\n        </view>\n      </uni-card>\n      <uni-load-more :status=\"pager.finished ? 'noMore' : pager.loading ? 'loading' : 'more'\" />\n    </view>\n\n    <view v-else class=\"empty\">\n      <text class=\"muted\">还没有答题记录，先去题库练习吧</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\nimport { computed, reactive, ref } from 'vue';\nimport { onPullDownRefresh, onReachBottom, onShow } from '@dcloudio/uni-app';\nimport { fetchCategories } from '@/api/categories.js';\nimport { fetchAnswerHistory } from '@/api/answers.js';\nimport { fetchQuestionDetail } from '@/api/questions.js';\n\nconst categories = ref([{ id: '', name: '全部' }]);\nconst records = ref([]);\nconst selectedCategory = ref('');\nconst pager = reactive({\n  page: 1,\n  size: 10,\n  total: 0,\n  finished: false,\n  loading: false,\n});\nconst questionCache = reactive({});\nconst loading = ref(false);\n\nconst categoryNames = computed(() => categories.value.map((c) => c.name));\nconst currentCategoryLabel = computed(() => {\n  const target = String(selectedCategory.value || '');\n  return categories.value.find((c) => String(c.id) === target)?.name || '全部';\n});\n\nconst filteredRecords = computed(() => {\n  if (!selectedCategory.value) return records.value;\n  const target = String(selectedCategory.value);\n  return records.value.filter((item) => String(item.categoryId) === target);\n});\n\nconst getCategoryName = (id) =>\n  categories.value.find((c) => String(c.id) === String(id))?.name || '未分类';\n\nconst renderDifficulty = (difficulty) => {\n  const t = String(difficulty || '').toLowerCase();\n  if (t.includes('hard')) return '困难';\n  if (t.includes('medium')) return '中等';\n  if (t.includes('easy')) return '容易';\n  return difficulty || '未设置';\n};\n\nconst onCategoryChange = (e) => {\n  const index = Number(e.detail.value);\n  selectedCategory.value = categories.value[index]?.id || '';\n};\n\nconst formatTime = (timeStr) => {\n  if (!timeStr) return '';\n  const date = new Date(timeStr);\n  return `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(\n    date.getMinutes(),\n  ).padStart(2, '0')}`;\n};\n\nconst loadCategories = async () => {\n  try {\n    const list = await fetchCategories();\n    categories.value = [{ id: '', name: '全部' }, ...list];\n  } catch (err) {\n    console.error(err);\n  }\n};\n\nconst enrichWithQuestionDetail = async (list = []) => {\n  const ids = [...new Set(list.map((item) => item.questionId).filter(Boolean))].filter(\n    (id) => !questionCache[id],\n  );\n  if (ids.length) {\n    const detailList = await Promise.all(\n      ids.map((id) =>\n        fetchQuestionDetail(id)\n          .then((detail) => ({ id, detail }))\n          .catch(() => ({ id, detail: null })),\n      ),\n    );\n    detailList.forEach(({ id, detail }) => {\n      questionCache[id] = detail;\n    });\n  }\n  return list.map((item) => {\n    const detail = questionCache[item.questionId];\n    return {\n      ...item,\n      categoryId: detail?.categoryId,\n      categoryName: detail ? getCategoryName(detail.categoryId) : '',\n    };\n  });\n};\n\nconst loadRecords = async (reset = false) => {\n  if (pager.loading || (pager.finished && !reset)) return;\n  pager.loading = true;\n  loading.value = reset;\n  try {\n    const pageToLoad = reset ? 1 : pager.page;\n    const res = await fetchAnswerHistory({ page: pageToLoad, size: pager.size });\n    pager.total = res.total || 0;\n    const enriched = await enrichWithQuestionDetail(res.records || []);\n    if (reset) {\n      records.value = enriched;\n      pager.page = 2;\n      pager.finished = records.value.length >= pager.total || !enriched.length;\n    } else {\n      records.value = [...records.value, ...enriched];\n      pager.page += 1;\n      if (!enriched.length || records.value.length >= pager.total) {\n        pager.finished = true;\n      }\n    }\n  } catch (err) {\n    console.error(err);\n    uni.showToast({ title: '加载记录失败', icon: 'none' });\n  } finally {\n    pager.loading = false;\n    loading.value = false;\n  }\n};\n\nonShow(() => {\n  loadCategories();\n  loadRecords(true);\n});\n\nonPullDownRefresh(async () => {\n  await loadCategories();\n  await loadRecords(true);\n  uni.stopPullDownRefresh();\n});\n\nonReachBottom(() => {\n  loadRecords(false);\n});\n</script>\n\r\n<style lang=\"scss\" scoped>\r\n.page {\r\n  padding: 20rpx;\r\n}\r\n\r\n.filter {\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.picker {\r\n  padding: 16rpx;\r\n  border-radius: 12rpx;\r\n  background: #f3f4f6;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12rpx;\r\n}\r\n\r\n.record-card {\r\n  margin-bottom: 14rpx;\r\n}\r\n\r\n.row {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12rpx;\r\n  margin: 6rpx 0;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.muted {\r\n  color: #6b7280;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.answer-row {\r\n  display: flex;\r\n  gap: 10rpx;\r\n  margin-top: 4rpx;\r\n  color: #1f2937;\r\n}\r\n\r\n.empty {\r\n  padding: 40rpx;\r\n  text-align: center;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/project/practice-app/practice-app-ui/pages/records/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","computed","fetchCategories","uni","fetchQuestionDetail","fetchAnswerHistory","onShow","onPullDownRefresh","onReachBottom"],"mappings":"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"}