{"version":3,"file":"questions.js","sources":["api/questions.js"],"sourcesContent":["import { request, upload } from './http';\n\r\nfunction pickRecords(payload) {\r\n  const data = payload && typeof payload === 'object' ? payload : {};\r\n  if (Array.isArray(data.records)) return { records: data.records, meta: data };\r\n  if (Array.isArray(data.list)) return { records: data.list, meta: data };\r\n  if (Array.isArray(data.data?.records)) return { records: data.data.records, meta: data.data };\r\n  if (Array.isArray(data.data?.list)) return { records: data.data.list, meta: data.data };\r\n  return { records: [], meta: data };\r\n}\r\n\r\nfunction legacyOptionsFromObject(data = {}) {\r\n  const list = [];\r\n  const choiceKeys = ['A', 'B', 'C', 'D', 'E', 'F'];\r\n  choiceKeys.forEach((letter) => {\r\n    const val = data[`option${letter}`] || data[`option${letter.toLowerCase()}`];\r\n    if (val) {\r\n      list.push({ value: letter, text: val, label: val });\r\n    }\r\n  });\r\n  if (list.length) return list;\r\n  const tVal = data.optionTrue || data.optionT;\r\n  const fVal = data.optionFalse || data.optionF;\r\n  if (tVal || fVal) {\r\n    return [\r\n      { value: 'T', text: tVal || '正确', label: tVal || '正确' },\r\n      { value: 'F', text: fVal || '错误', label: fVal || '错误' },\r\n    ];\r\n  }\r\n  return [];\r\n}\r\n\r\nfunction normalizeOptions(raw) {\n  if (!raw) return [];\n  if (Array.isArray(raw)) {\n    return raw.map((opt, idx) => ({\n      value: opt.value || String.fromCharCode(65 + idx),\n      text: opt.label || opt.text || opt.value || '',\n      label: opt.label || opt.text || opt.value || '',\n      correct: opt.correct,\n      images: Array.isArray(opt.images) ? opt.images : [],\n    }));\n  }\n  if (typeof raw === 'string') {\n    try {\n      const parsed = JSON.parse(raw);\n      return normalizeOptions(parsed);\r\n    } catch (err) {\r\n      return [];\r\n    }\r\n  }\r\n  return [];\r\n}\r\n\r\nexport function normalizeQuestion(data = {}) {\n  const typeRaw = String(data.type || '').toLowerCase();\n  let type = data.type;\n  if (typeRaw.includes('multiple')) type = 'multiple';\n  else if (typeRaw.includes('true') || typeRaw.includes('judge')) type = 'truefalse';\n  else if (typeRaw.includes('fill') || typeRaw.includes('short')) type = 'short';\r\n  else if (typeRaw.includes('single')) type = 'single';\r\n  let options = normalizeOptions(data.options || data.optionsJson);\r\n  if (!options.length) {\r\n    options = legacyOptionsFromObject(data);\r\n  }\r\n  if ((!options || options.length === 0) && type === 'truefalse') {\r\n    options = [\r\n      { value: 'T', text: '正确', label: '正确' },\r\n      { value: 'F', text: '错误', label: '错误' },\r\n    ];\r\n  }\r\n  return {\r\n    id: data.id,\r\n    title: data.content || data.title || '',\r\n    type,\r\n    options,\r\n    score: data.score || 0,\r\n    duration: data.duration || 0,\r\n    explanation: data.explanation,\r\n    categoryId: data.categoryId,\r\n    difficulty: data.difficulty,\r\n    answer:\r\n      typeof data.answer === 'string'\r\n        ? data.answer.split(/[,;\\s]+/).filter(Boolean)\r\n        : Array.isArray(data.answer)\r\n          ? data.answer\r\n          : [],\r\n  };\n}\n\nexport async function fetchQuestionRaw(id) {\n  return request({ url: `/questions/${id}`, method: 'GET' });\n}\n\nexport async function fetchQuestionDetail(id) {\n  const res = await fetchQuestionRaw(id);\n  return normalizeQuestion(res);\n}\n\nexport async function createQuestion(payload) {\n  return request({ url: '/questions', method: 'POST', data: payload });\n}\n\nexport async function updateQuestion(id, payload) {\n  if (!id) throw new Error('缺少题目ID');\n  return request({ url: `/questions/${id}`, method: 'PUT', data: payload });\n}\n\nexport async function uploadQuestionImage(filePath) {\n  if (!filePath) throw new Error('缺少文件路径');\n  return upload({ url: '/files/questions', filePath, name: 'file' });\n}\n\nexport async function fetchQuestionPage(params = {}) {\n  const { page = 1, size = 10, categoryId, difficulty, keyword } = params;\n  const res = await request({\n    url: '/questions',\r\n    method: 'GET',\r\n    data: { page, size, categoryId, difficulty, keyword },\r\n  });\r\n  const { records: rawList, meta } = pickRecords(res);\r\n  const records = rawList.map((item) => normalizeQuestion(item));\r\n  const totalVal = meta?.total ?? meta?.count ?? records.length;\r\n  const total = typeof totalVal === 'number' ? totalVal : Number(totalVal) || records.length;\r\n  return {\r\n    page: Number(meta?.page ?? meta?.current ?? page) || page,\r\n    size: Number(meta?.size ?? meta?.pageSize ?? size) || size,\r\n    total,\r\n    records,\r\n  };\r\n}\r\n\r\nexport async function fetchPracticeSequence(params = {}) {\r\n  const { categoryId, page = 1, size = 10 } = params;\r\n  const res = await request({\r\n    url: '/questions/practice/sequence',\r\n    method: 'GET',\r\n    data: { categoryId, page, size },\r\n  });\r\n  const { records: rawList, meta } = pickRecords(res);\r\n  const records = rawList.map((item) => normalizeQuestion(item));\r\n  const totalVal = meta?.total ?? meta?.count ?? records.length;\r\n  const total = typeof totalVal === 'number' ? totalVal : Number(totalVal) || records.length;\r\n  return {\r\n    page: Number(meta?.page ?? meta?.current ?? page) || page,\r\n    size: Number(meta?.size ?? meta?.pageSize ?? size) || size,\r\n    total,\r\n    records,\r\n  };\r\n}\r\n\r\nexport async function fetchPracticeRandom(params = {}) {\r\n  const { categoryId, difficulty, limit = 5 } = params;\r\n  const res = await request({\r\n    url: '/questions/practice/random',\r\n    method: 'GET',\r\n    data: { categoryId, limit },\r\n  });\r\n  const { records: rawList } = Array.isArray(res) ? { records: res } : pickRecords(res);\r\n  return rawList.map((item) => normalizeQuestion(item));\r\n}\r\n"],"names":["request","upload"],"mappings":"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"}