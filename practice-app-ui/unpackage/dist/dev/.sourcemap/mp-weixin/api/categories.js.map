{"version":3,"file":"categories.js","sources":["api/categories.js"],"sourcesContent":["import { request } from './http';\n\nfunction normalizeNode(node = {}) {\n  return {\n    id: node.id,\n    name: node.name,\n    parentId: node.parentId,\n    badgeText: node.badgeText,\n    questionCount: node.questionCount || 0,\n    finishedCount: node.finishedCount || 0,\n    children: Array.isArray(node.children)\n      ? node.children.map((child) => normalizeNode(child))\n      : [],\n  };\n}\n\n// 简单缓存分类树，减少重复请求导致的等待\nlet cachedTree = null;\nlet cachedAt = 0;\nlet pendingPromise = null;\nconst CACHE_TTL = 60 * 1000; // 1 分钟\n\nfunction cloneTree(tree) {\n  return JSON.parse(JSON.stringify(tree));\n}\n\nexport async function fetchCategoryTree(force = false) {\n  const now = Date.now();\n  if (!force && cachedTree && now - cachedAt < CACHE_TTL) {\n    return cloneTree(cachedTree);\n  }\n  if (!force && pendingPromise) {\n    return cloneTree(await pendingPromise);\n  }\n  pendingPromise = request({ url: '/categories/tree', method: 'GET' }).then((tree) => {\n    if (!Array.isArray(tree)) return [];\n    const normalized = tree.map((item) => normalizeNode(item));\n    cachedTree = normalized;\n    cachedAt = Date.now();\n    return normalized;\n  }).finally(() => {\n    pendingPromise = null;\n  });\n  const result = await pendingPromise;\n  return cloneTree(result);\n}\n\nexport async function fetchCategories() {\n  const list = await request({ url: '/categories', method: 'GET' });\n  if (!Array.isArray(list)) return [];\n  return list.map((item) => ({\n    id: item.id,\n    name: item.name,\n    description: item.description,\n    parentId: item.parentId,\n    badgeText: item.badgeText,\n    sort: item.sort,\n  }));\n}\n\nexport function flattenCategoryTree(tree = []) {\n  const result = [];\n  const walk = (nodes) => {\n    (nodes || []).forEach((node) => {\n      result.push(node);\n      if (node.children && node.children.length) {\n        walk(node.children);\n      }\n    });\n  };\n  walk(tree);\n  return result;\n}\n\nexport function categoryNameById(list = [], id) {\n  return list.find((item) => String(item.id) === String(id))?.name || '';\n}\n"],"names":["request"],"mappings":";;AAEA,SAAS,cAAc,OAAO,IAAI;AAChC,SAAO;AAAA,IACL,IAAI,KAAK;AAAA,IACT,MAAM,KAAK;AAAA,IACX,UAAU,KAAK;AAAA,IACf,WAAW,KAAK;AAAA,IAChB,eAAe,KAAK,iBAAiB;AAAA,IACrC,eAAe,KAAK,iBAAiB;AAAA,IACrC,UAAU,MAAM,QAAQ,KAAK,QAAQ,IACjC,KAAK,SAAS,IAAI,CAAC,UAAU,cAAc,KAAK,CAAC,IACjD,CAAE;AAAA,EACV;AACA;AAGA,IAAI,aAAa;AACjB,IAAI,WAAW;AACf,IAAI,iBAAiB;AACrB,MAAM,YAAY,KAAK;AAEvB,SAAS,UAAU,MAAM;AACvB,SAAO,KAAK,MAAM,KAAK,UAAU,IAAI,CAAC;AACxC;AAEO,eAAe,kBAAkB,QAAQ,OAAO;AACrD,QAAM,MAAM,KAAK;AACjB,MAAI,CAAC,SAAS,cAAc,MAAM,WAAW,WAAW;AACtD,WAAO,UAAU,UAAU;AAAA,EAC5B;AACD,MAAI,CAAC,SAAS,gBAAgB;AAC5B,WAAO,UAAU,MAAM,cAAc;AAAA,EACtC;AACD,mBAAiBA,SAAAA,QAAQ,EAAE,KAAK,oBAAoB,QAAQ,OAAO,EAAE,KAAK,CAAC,SAAS;AAClF,QAAI,CAAC,MAAM,QAAQ,IAAI;AAAG,aAAO,CAAA;AACjC,UAAM,aAAa,KAAK,IAAI,CAAC,SAAS,cAAc,IAAI,CAAC;AACzD,iBAAa;AACb,eAAW,KAAK;AAChB,WAAO;AAAA,EACX,CAAG,EAAE,QAAQ,MAAM;AACf,qBAAiB;AAAA,EACrB,CAAG;AACD,QAAM,SAAS,MAAM;AACrB,SAAO,UAAU,MAAM;AACzB;AAEO,eAAe,kBAAkB;AACtC,QAAM,OAAO,MAAMA,SAAAA,QAAQ,EAAE,KAAK,eAAe,QAAQ,MAAK,CAAE;AAChE,MAAI,CAAC,MAAM,QAAQ,IAAI;AAAG,WAAO,CAAA;AACjC,SAAO,KAAK,IAAI,CAAC,UAAU;AAAA,IACzB,IAAI,KAAK;AAAA,IACT,MAAM,KAAK;AAAA,IACX,aAAa,KAAK;AAAA,IAClB,UAAU,KAAK;AAAA,IACf,WAAW,KAAK;AAAA,IAChB,MAAM,KAAK;AAAA,EACZ,EAAC;AACJ;AAEO,SAAS,oBAAoB,OAAO,IAAI;AAC7C,QAAM,SAAS,CAAA;AACf,QAAM,OAAO,CAAC,UAAU;AACtB,KAAC,SAAS,CAAA,GAAI,QAAQ,CAAC,SAAS;AAC9B,aAAO,KAAK,IAAI;AAChB,UAAI,KAAK,YAAY,KAAK,SAAS,QAAQ;AACzC,aAAK,KAAK,QAAQ;AAAA,MACnB;AAAA,IACP,CAAK;AAAA,EACL;AACE,OAAK,IAAI;AACT,SAAO;AACT;AAEO,SAAS,iBAAiB,OAAO,CAAE,GAAE,IAAI;;AAC9C,WAAO,UAAK,KAAK,CAAC,SAAS,OAAO,KAAK,EAAE,MAAM,OAAO,EAAE,CAAC,MAAlD,mBAAqD,SAAQ;AACtE;;;;;"}